stages:
- build
- deploy

build-frontend:
  stage: build
  image: node:latest
  script:
  - echo "Compiling the code..."
  - cd FrontEnd
  - npm install --force
  - CI=false npm run build
  artifacts:
    paths:
      - FrontEnd/build 
  rules:
    - changes:
      - FrontEnd/**/*

deploy-frontend:
  stage: deploy
  image: python:latest
  variables:
    AWS_ACCESS_KEY_ID: "$AWS_ACCESS_KEY_ID"
    AWS_SECRET_ACCESS_KEY: "$AWS_SECRET_ACCESS_KEY"
    AWS_DEFAULT_REGION: "$AWS_DEFAULT_REGION"
  script:
    - echo "Deploying application. FrontEnd.."
    - apt-get update
    - apt-get upgrade
    - export TZ=Europe/Paris
    - ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
    - apt-get install -y awscli
    - aws s3 sync FrontEnd/build/ s3://0521ptc8n2-g07-fronted-v2 --acl public-read
  rules:
  - changes:
    - FrontEnd/**/*