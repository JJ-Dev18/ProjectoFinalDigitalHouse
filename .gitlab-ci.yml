stages:
- build
- deploy

build-backend:
  stage: build
  image: maven:latest
  script:
  - echo "Compiling the code..."
  - cd BackEnd/DHBooking
  - mvn compile install
  artifacts:
    paths:
      - BackEnd/DHBooking/target/*.jar
  rules:
  - changes:
    - BackEnd/**/*

deploy-backend:
  stage: deploy
  image: ubuntu:latest
  script:
    - echo "Deploying application. backend.."
    - apt-get update
    - apt-get upgrade
    - export TZ=Europe/Paris
    - ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
    - apt-get install -y awscli
    - aws configure set aws_access_key_id AKIASDYGBXDR7W6DXTFF
    - aws configure set aws_secret_access_key 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
    - aws configure set region us-east-2
    - scp -i grupo7.pem BackEnd/DHBooking/target/*.jar ubuntu@ec2-52-14-228-70.us-east-2.compute.amazonaws.com:~/. app.jar
  rules:
  - changes:
    - BackEnd/**/*